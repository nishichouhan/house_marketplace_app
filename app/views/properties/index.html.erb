<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Properties</title>
  <style>
    /* Styles for desktop */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
    }
    th, td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #f2f2f2;
    }
    /* Styles for mobile */
    @media only screen and (max-width: 600px) {
      table, thead, tbody, th, td, tr {
        display: block;
      }
      thead tr {
        position: absolute;
        top: -9999px;
        left: -9999px;
      }
      tr { border: 1px solid #ccc; }
      td {
        border: none;
        border-bottom: 1px solid #eee;
        position: relative;
        padding-left: 50%;
      }
      td:before {
        position: absolute;
        top: 6px;
        left: 6px;
        width: 45%;
        padding-right: 10px;
        white-space: nowrap;
        content: attr(data-label);
      }
    }
    /* Additional styling for form */
    form {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    select {
      width: 100%;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #ccc;
      margin-bottom: 10px;
      font-size: 16px;
    }
    input[type="submit"] {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }
    input[type="submit"]:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>

<h1>All Properties</h1>
<%= will_paginate @properties %>

<%= form_with(url: properties_path, method: "get") do %>
  <div style="display: flex; justify-content: space-between;">
    <div style="width: 20%;">
      <label for="property_type">Type:</label>
      <%= select_tag :property_type, options_for_select(['Residential', 'Commercial', 'Industrial'], params[:property_type]) %>
    </div>
    <div style="width: 20%;">
      <label for="city">City:</label>
      <%= select_tag :city, options_for_select(Property.distinct.pluck(:city), params[:city]) %>
    </div>
    <div style="width: 20%;">
      <label for="district">District:</label>
      <%= select_tag :district, options_for_select(Property.distinct.pluck(:district), params[:district]) %>
    </div>
    <div style="width: 20%;">
      <label for="net_size">Net Size:</label>
      <%= select_tag :net_size, options_for_select(Property.distinct.pluck(:net_size), params[:net_size]) %>
    </div>
    <div style="width: 20%;">
      <label for="rent_per_month">Rent Per Month:</label>
      <%= select_tag :rent_per_month, options_for_select(Property.distinct.pluck(:rent_per_month), params[:rent_per_month]) %>
    </div>
  </div>
  <%= submit_tag "Search" %>
<% end %>

<table>
  <thead>
    <tr>
      <th>Title</th>
      <th>City</th>
      <th>District</th>
      <th>Bedrooms</th>
      <th>Rent</th>
      <th>MRT Line</th>
      <th>NET SIZE</th>
      <th>Actions</th> <!-- New column for favorite button -->
    </tr>
  </thead>
  <tbody>
    <% @properties.each do |property| %>
      <tr>
        <td data-label="Title"><%= property.property_type %></td>
        <td data-label="City"><%= property.city %></td>
        <td data-label="District"><%= property.district %></td>
        <td data-label="Bedrooms"><%= property.bedrooms %></td>
        <td data-label="Rent"><%= property.rent_per_month %></td>
        <td data-label="MRT Line"><%= property.mrt_line %></td>
        <td data-label="NET SIZE"><%= property.net_size %></td>
        <td data-label="Actions">
          <% if current_user&.favorite_properties&.include?(property) %>
            <%= link_to "Remove from Favorites", remove_favorite_path(property_id: property.id), method: :delete, remote: true, class: "btn btn-danger btn-sm" %>
          <% else %>
            <%= form_with(url: add_favorite_path(property_id: property.id), method: "post", local: true) do |form| %>
              <%= form.submit "Add to Favorites", class: "btn btn-primary btn-sm" %>
            <% end %>
          <% end %>
          <% if current_user.user_type == "admin" %>
            <%= link_to "Edit", edit_property_path(property), class: "btn btn-info btn-sm" %>
            <%= button_to "Delete", property_path(property), method: :delete, class: "btn btn-danger btn-sm", onclick: "return confirm('Are you sure?')" %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

</body>
</html>
